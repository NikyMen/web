<main class="max-w-screen-md mx-auto px-4 py-10">
  <div class="bg-white rounded shadow p-6">
    <img src="<%= producto.imagen %>" alt="<%= producto.nombre %>" class="w-full h-60 object-contain mb-4" />

    <h1 class="text-2xl font-bold mb-2 text-gray-900"><%= producto.nombre %></h1>
    <p class="text-gray-700 mb-2">CÃ³digo: <%= producto.codigo %></p>
    <p class="text-blue-700 text-xl font-semibold mb-6">$ <%= producto.precio.toLocaleString('es-AR') %></p>

    <form id="formAgregarCarrito" class="mt-6">
  <input type="hidden" name="codigo" value="<%= producto.codigo %>">
  <label class="block mb-2 text-sm font-medium text-gray-700">Cantidad:</label>
  <input
    type="number"
    name="cantidad"
    value="1"
    min="1"
    class="w-24 px-3 py-2 border rounded mb-4"
  >
  <button
    type="submit"
    class="bg-blue-800 text-white px-6 py-3 rounded hover:bg-blue-700 transition"
  >
    ðŸ›’ Agregar al carrito
  </button>
</form>

<script>
document.getElementById("formAgregarCarrito").addEventListener("submit", async function (e) {
  e.preventDefault();

  const form = e.target;
  const codigo = form.codigo.value;
  const cantidad = parseInt(form.cantidad.value) || 1;

  // Guardar en localStorage (opcional si querÃ©s mantener local el carrito)
  const carrito = JSON.parse(localStorage.getItem("carrito")) || {};
  carrito[codigo] = (carrito[codigo] || 0) + cantidad;
  localStorage.setItem("carrito", JSON.stringify(carrito));

  // Enviar al backend
  await fetch("/carrito/agregar", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ codigo, cantidad })
  });

  // Mostrar notificaciÃ³n + actualizar contador
  mostrarNotificacion();
  actualizarContadorCarrito();

  function mostrarNotificacion() {
  const noti = document.getElementById("notificacionCarrito");
  if (!noti) return;
  noti.classList.remove("hidden");
  noti.classList.add("opacity-100");

  setTimeout(() => {
    noti.classList.add("hidden");
    noti.classList.remove("opacity-100");
  }, 2500);
}

async function actualizarContadorCarrito() {
  const res = await fetch("/carrito/json");
  const productos = await res.json();
  const total = productos.reduce((acc, p) => acc + p.cantidad, 0);
  const contador = document.getElementById("contadorCarrito");
  if (contador) contador.textContent = total;
}
});
</script>

  </div>
</main>


</div>